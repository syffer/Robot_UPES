package rajan;


import java.util.List;
import java.util.ArrayList;
import java.util.HashSet;
import java.util.Set;


public class Rajan {
	
	public static List<Set<Integer>> forward(List<Set<Integer>> sequences) throws RajanException { 
		if(!Utils.isPowerOf2(sequences.size())) throw new RajanException("The length has to be a power of 2");
		
		System.out.println("Number of sequences : " + sequences.size());
		System.out.println("Number of steps : " + Utils.log2(sequences.size()));
		
		return forwardRecursive(sequences);
	}
	
	
	private static List<Set<Integer>> forwardRecursive(List<Set<Integer>> sequences) {
		
		if(sequences.size() == 1) return sequences;
		
		List<Set<Integer>> G = new ArrayList<Set<Integer>>();
		List<Set<Integer>> H = new ArrayList<Set<Integer>>();
		
		int mid = sequences.size() / 2;
		for(int i = 0; i < mid; i++) {
			Set<Integer> tmp = (HashSet<Integer>) Utils.union(sequences.get(i), sequences.get(i + mid));
			G.add(tmp);	
		}
		
		for(int i = mid; i < sequences.size(); i++) {
			Set<Integer> tmp = (HashSet<Integer>) Utils.difference(sequences.get(i), sequences.get(i - mid));
			H.add(tmp); 
		}
		
		List<Set<Integer>> nextG = forwardRecursive(G);
		List<Set<Integer>> nextH = forwardRecursive(H);
		
		nextG.addAll(nextH);
		
		return nextG;
	}
	
	public static List<Set<Integer>> reverse(List<Set<Integer>> sequences) throws RajanException { 
		throw new RajanException("The length has to be a power of 2");
	}
}
