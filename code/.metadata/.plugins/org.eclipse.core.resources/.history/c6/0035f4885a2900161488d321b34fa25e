package view;

import java.awt.Container;
import java.io.File;

import javax.imageio.ImageIO;
import javax.swing.JDesktopPane;
import javax.swing.JFileChooser;
import javax.swing.JFrame;
import javax.swing.JMenu;
import javax.swing.JMenuBar;
import javax.swing.JMenuItem;
import javax.swing.filechooser.FileFilter;
import javax.swing.filechooser.FileNameExtensionFilter;


public class View extends JFrame {
	
	private static final long serialVersionUID = 2118299654730994785L;

	private Container container;
	
	// menu 
	public JMenuItem menuLoad;
	public JMenuItem menuSave;
	public JMenuItem menuSaveAs;
	
	// internals windows 
	public JDesktopPane desktop;
	
	// open and save file 
	public JFileChooser fileChooserOpen;
	public JFileChooserConfirm fileChooserSave;
	
	
	public View() {
		super("Robot");
		
		this.container = this.getContentPane();
		
		this.initialiseMenuBar();
		this.initialiseFileChooser();
		this.initialiseDesktop();
				
		this.setDefaultCloseOperation(JFrame.DISPOSE_ON_CLOSE); // close the window when you clic en "x" 
		this.pack();
		this.setSize(600, 600);
		this.setVisible(true);
	}
	
	
	private void initialiseMenuBar() {
		JMenuBar menuBar = new JMenuBar();
		
		JMenu menuFile = new JMenu("File");
		this.menuLoad = new JMenuItem("Load");
		this.menuSave = new JMenuItem("Save");
		this.menuSaveAs = new JMenuItem("Save as ...");
		menuFile.add(this.menuLoad);
		//menuFile.add(this.menuSave);
		menuFile.add(this.menuSaveAs);
		
		menuBar.add(menuFile);
		
		this.setJMenuBar(menuBar);
	}
	
	private void initialiseFileChooser() { 
		this.fileChooserOpen = new JFileChooser();
		this.fileChooserSave = new JFileChooserConfirm();
		
		// get only image file 
		FileFilter filter = new FileNameExtensionFilter("Image files", ImageIO.getReaderFileSuffixes());
		
		this.fileChooserOpen.setFileFilter(filter);
		this.fileChooserSave.setFileFilter(filter);
	}
	
	private void initialiseDesktop() {
		this.desktop = new JDesktopPane();
		this.add(desktop);
	}
	
	
	public ImageView getSelectedImageView() {
		return (ImageView) this.desktop.getSelectedFrame();
	}
	
	
	public File getFileToLoad() throws JFileChooserException {
		
		int results = this.fileChooserOpen.showOpenDialog(this);
		
		if(results != JFileChooser.APPROVE_OPTION) throw new JFileChooserException("");
		
		File file = this.fileChooserOpen.getSelectedFile();
		
		return file;
	}	
	
	
	public File getFileToSave() {
		
		int resultat = this.fileChooserSave.showSaveDialog(this);
		
		if( resultat != JFileChooser.APPROVE_OPTION ) throw new ChoixAnnulerException("sauvegarde annulée");
		
		File fichier = this.fileChooserSave.getSelectedFile();
		
		// on ajoute l'extention ".tournoi" si elle n'y est pas
		String cheminFichier = fichier.getAbsolutePath();
		if( ! cheminFichier.endsWith(".tournoi") && ! cheminFichier.endsWith(".TOURNOI") ) {
			fichier = new File( fichier.getAbsoluteFile() + ".tournoi" );
		}
				
		return fichier;
		
		return null;
	}
	
}